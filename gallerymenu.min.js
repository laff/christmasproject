function Bounds(){this.sHeight=null,this.sWidth=null,this.orientation=null,this.iHeight=null,this.iWidth=null,this.waiting=!1,this.images=null,this.structure=null}function Defs(a){this.svg=a,this.patterns=a.patterns,this.patternCount=this.patterns.length;try{this.defs=document.createElementNS("http://www.w3.org/2000/svg","defs")}catch(a){console.log(a),this.defs=document.createElement("http://www.w3.org/2000/svg","defs")}}function Frame(a){this.vertices=a||[{x:0,y:0}],this.calcDimensions(),this.createPath(this.createPathStr())}function Frames(){this.init()}function Galla(a){this.options=a,bounds.setImages(a.patterns)}function Path(a,b,c,d){this.paths=[],this.anchor=a,this.fill=c,this.fillStr="url(#"+c.id+")",this.element=this.create(b),this.adjust(d)}function Svg(a){this.svg=null,this.svgId=a.svgId,this.defs=null,this.paths=null,this.frame=null,this.patterns=a.patterns,this.pathStrings=a.pathStrings}function rand(a,b){return Math.floor(Math.random()*(b-a))+a}Bounds.prototype={init:function(){return this.setDisplay(),this.setInner(),window.onresize=this.response,screen.orientation?screen.orientation.onchange=this.orient:console.log("there are no screen.orientation on ie"),this},orient:function(){bounds.setDisplay()},response:function(){bounds.waiting||(bounds.waiting=!0,setTimeout(function(){bounds.waiting=!1,bounds.setInner()},50))},setDisplay:function(){this.sHeight=screen.availHeight,this.sWidth=screen.availWidth},setInner:function(){this.iHeight=window.innerHeight,this.iWidth=window.innerWidth,this.orientation=Math.floor(this.iHeight/this.iWidth)?"vertical":"horizontal","undefined"!=typeof galla&&(galla.svg.updateDimensions(),this.structure=this.frameup(),galla.update())},frameup:function(){function a(){function a(){for(var a=c,b=0;a--;)b+=j[a];return b}function b(){for(var e=c;e--;)i=h<f?h:rand(0,f),j[e]+=i,h-=i;h&&a()<d&&b()}var c,f,g,h,i,j=[],k=Math.floor(Math.sqrt(d));for("horizontal"==e?(f=k,c=Math.floor(d/k)):(c=k,f=Math.floor(d/k)),h=d-c*f,g=c;g--;)j[g]=f;return b(),j}var b=50,c=(this.iWidth-2*b,this.iHeight-2*b,this.images),d=c.length,e=this.orientation;return a()},setImages:function(a){this.images=a,this.structure=this.frameup()}},Defs.prototype={init:function(){for(var a=this.patterns.length;a--;)this.addPattern(this.patterns[a]);this.updateDefs()},fillGen:function(){var a=(this.patternCount,0),b=this.patterns;return{get:function(){return b[a++]}}},updateDefs:function(){this.svg.updateDefs(this.defs)},addPattern:function(a){var b,c,d=this.defs,e=a.image;try{b=document.createElementNS("http://www.w3.org/2000/svg","pattern"),c=document.createElementNS("http://www.w3.org/2000/svg","image"),b.setAttributeNS(null,"id",a.id),b.setAttributeNS(null,"patternUnits",a.patternUnits),b.setAttributeNS(null,"width",a.width),b.setAttributeNS(null,"height",a.height),c.setAttributeNS("http://www.w3.org/1999/xlink","href",e.href),c.setAttributeNS(null,"x",e.x),c.setAttributeNS(null,"y",e.y),c.setAttributeNS(null,"width",e.width),c.setAttributeNS(null,"height",e.height)}catch(d){console.log(d),b=document.createElement("pattern"),c=document.createElement("image"),b.setAttribute("id",a.id),b.setAttribute("patternUnits",a.patternUnits),b.setAttribute("width",a.width),b.setAttribute("height",a.height),c.setAttribute("href",e.href),c.setAttribute("x",e.x),c.setAttribute("y",e.y),c.setAttribute("width",e.width),c.setAttribute("height",e.height)}b.appendChild(c),d.appendChild(b),this.updateDefs()}},Frame.prototype={path:null,dimensions:null,calcDimensions:function(){function a(a,b){var c=a.x>=b.x&&a.y>=b.y?b:a,d=a.x>=b.x&&a.y>=b.y?a:b,e=Math.sqrt(Math.pow(d.x-c.x,2)+Math.pow(d.y-c.y,2));return e}var b=this.vertices,c=a(b[0],b[3]),d=a(b[1],b[2]),e=a(b[0],b[1]),f=a(b[3],b[2]);this.dimensions={topWidth:c,bottomWidth:d,leftHeight:e,rightHeight:f}},update:function(a){this.vertices=a,this.calcDimensions(),this.path.update(this.vertices[0],this.createPathStr(),this.dimensions)},createPathStr:function(){var a=this.vertices,b=a.length,c=1,d=a[0],e="M"+d.x+","+d.y+" ";for(c;c<b;c++)e+="l"+(a[c].x-a[c-1].x)+","+(a[c].y-a[c-1].y)+" ";return e+="l"+(a[b-1].x-a[0].x)+","+(a[b-1].y-a[0].y)},createPath:function(a){this.addPath(new Path(this.vertices[0],a,galla.svg.fill.get(),this.dimensions))},addPath:function(a){this.path=a,galla.svg.addPath(a.element)},remove:function(){}},Frames.prototype={viewbox:null,scale:null,spacing:10,border:50,frameArr:[],tmpFrames:[],coordinates:{cols:[]},lengths:[],init:function(){this.update();for(var a=this.frameArr,b=this.tmpFrames,c=b.length;c--;)a[c]=new Frame(b[c])},update:function(){this.updateNumbers(),this.createColumns(),this.createRows(),this.createFrames()},updateFrames:function(){var a=this.tmpFrames,b=this.frameArr,c=a.length,d=0;for(d;d<c;d++)b[d].update(a[d])},updateNumbers:function(){var a=galla.svg.svg;this.viewbox=a.viewBox.baseVal,this.scale={width:a.width.baseVal.value,height:a.height.baseVal.value}},randLengths:function(a,b){var c,d=0,e=[],f=0,g=0,h=0;for(d;d<b;d++)g>=a.length?(console.log("__________________________________"),console.log("sum is now larger than total length of side!"),console.log("____________________________________")):d==b-1?e.push(a.length-g):(f=a.part,c=rand(a.add/2,a.add+h),h+=a.add-c,g+=f+c,e.push(f+c));return e},createColumns:function(){function a(a,d){var e,g,h,i,j=[],k=a.length,l=0;for(l;l<k;l++)e=!!l*b,g=!l*c,h=l?j[l-1][3].x:0,i=l?j[l-1][2].x:0,j[l]=[{x:g+e+h,y:c},{x:g+e+i,y:f},{x:e+d[l]+i,y:f},{x:e+a[l]+h,y:c}];return j}var b=this.spacing,c=this.border,d=bounds.structure.length,e=this.viewbox.width-100,f=this.viewbox.height-100,g=this.randLengths({length:e,part:.9*e/d,add:.1*e/d},d),h=function(){for(var a=g.length,b=[];a--;)b.push(g[a]);return b}();this.coordinates.cols=a(g,h)},createRows:function(){function a(a){function f(a,b){var c=a.x>=b.x&&a.y>=b.y?b:a,d=a.x>=b.x&&a.y>=b.y?a:b,e=Math.sqrt(Math.pow(d.x-c.x,2)+Math.pow(d.y-c.y,2));return e}var g=c[a],i=g-1,j=f(b.cols[a][0],b.cols[a][1]),k=f(b.cols[a][2],b.cols[a][3]),l=j-e*i,m=k-e*i,n=l/g*.8,o=m/g*.8,p=l/g*.2,q=m/g*.2,r={length:l,part:n,add:p},s={length:m,part:o,add:q};d[a]={left:h(r,g),right:h(s,g)}}var b=this.coordinates,c=bounds.structure,d=this.lengths,e=this.spacing,f=b.cols.length,g=f,h=this.randLengths,i=0;for(i;i<g;i++)a(i)},createFrames:function(){function a(a,b){function c(a,b,c){if(!a)return b;var d=b.x>=c.x&&b.y>=c.y?c:b,e=b.x>=c.x&&b.y>=c.y?b:c,f=Math.sqrt(Math.pow(e.x-d.x,2)+Math.pow(e.y-d.y,2)),g=a/f,h={x:d.x-(g*d.x-g*e.x),y:d.y-(g*d.y-g*e.y)};return h}function d(b,d,g,h,i){var j=i?f:0,k=i?c(j,b,a[1]):b,l=c(g,k,a[1]),m=i?c(j,d,a[2]):d,n=c(h,m,a[2]);e.push([k,l,n,m])}var g=b.right.length,h=0;for(h;h<g;h++){var i=e[e.length-1],j=h?i[1]:a[0],k=h?i[2]:a[3];d(j,k,b.left[h],b.right[h],h)}}var b=this.coordinates.cols,c=b.length,d=this.lengths,e=this.tmpFrames=[],f=this.spacing,g=0;for(g;g<c;g++)a(b[g],d[g])}},Galla.prototype={frames:null,svg:null,init:function(){var a=this.options;this.frames=function(){return new Frames}(this.svg=new Svg(a).init())},update:function(){this.frames.update(),this.frames.updateFrames()}},Path.prototype={init:function(){this.iterate()},update:function(a,b,c){this.anchor=a,this.element.setAttributeNS(null,"d",b),this.adjust(c)},adjust:function(a){function b(){var a=i,b=j,c=g,d=h,e=1.11111111,f=c/a,k=d/b,l=f<k?f:k;return newWidth=c/l*e,newHeight=d/l*e,{width:newWidth,height:newHeight}}var c=document.getElementById(this.fill.id),d=c.firstChild,e=.9*this.anchor.x,f=.9*this.anchor.y,g=this.fill.width,h=this.fill.height,i=a.topWidth>a.bottomWidth?a.topWidth:a.bottomWidth,j=a.leftHeight>a.rightHeight?a.leftHeight:a.rightHeight,k=b();c.setAttributeNS(null,"width",k.width+e),c.setAttributeNS(null,"height",k.height+f),d.setAttributeNS(null,"x",e),d.setAttributeNS(null,"y",f),d.setAttributeNS(null,"width",k.width),d.setAttributeNS(null,"height",k.height)},iterate:function(){for(var a=this.pathStrings,b=a.length;b--;)this.create(a[b])},create:function(a){var b=document.createElementNS("http://www.w3.org/2000/svg","path");return b.setAttributeNS(null,"d",a),b.setAttributeNS(null,"fill",this.fillStr),this.element=b,b}},Svg.prototype={init:function(){return this.createSvg(),this.defs=new Defs(this),this.defs.init(),this.fill=this.defs.fillGen(),this.append(),this},append:function(){document.body.appendChild(this.svg)},createSvg:function(){var a=this.svgId;if(a){this.svg=document.getElementById(a);var b=document.getElementById("nosupport");console.log(this.svg),console.log(b);try{this.svg.removeChild(b)}catch(a){document.body.removeChild(b),console.log(a)}}else this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg");this.updateDimensions()},addPaths:function(a){for(var b=a.length;b--;)this.svg.appendChild(a[b])},addPath:function(a){this.svg.appendChild(a)},updateDimensions:function(){var a=bounds.iWidth-25,b=bounds.iHeight-25,c=a+"px",d=b+"px",e="0 0 "+a+" "+b;try{this.svg.setAttributeNS(null,"width",c),this.svg.setAttributeNS(null,"height",d),this.svg.setAttributeNS(null,"viewBox",e)}catch(a){console.log(a),this.svg.setAttribute("width",c),this.svg.setAttribute("height",d),this.svg.setAttribute("viewBox",e)}},updateDefs:function(a){this.svg.appendChild(a)}};var bounds=(new Bounds).init();